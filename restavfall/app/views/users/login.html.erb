<script>

var computationDone = false;
var runAnalysis = function(stage) {
    $.ajax({
        type: "GET",
        url: '/analyse/'+stage,
    })
    .success(function(data) {
        console.log(data)
        if (data['status'] == "OK") {
            statusChanged(data['text']);
            runAnalysis(data['next']);
        }
        else if (data['status'] == "Done") {
            if(data['friend']) {
                statusChanged("Your chosen friend is " + data['friend']['name']);
            }
            if(data['event']) {
                statusChanged("You are going to " + data['event']['name']);
            }
            if (computationDone === false) {
                computationDone = true;
                $("#new-friend").html("Give me another friend");
                $("#new-event").html("Give me another event");

                var app_id = 'app_id=649498578495089';
                var redirect = '&redirect_uri=https://apps.facebook.com/prosjektrestavfall/';
                var display = '&display=page';
                var link = 'https://facebook.com/'+data['event']['eventID']

                $("#postShare").html("Del dette!");
                $('#postShare').attr('href', 
                        'https://www.facebook.com/dialog/share?'+app_id+display+redirect+'&href='+link);

                link = 'https://uka.no';

                $("#sendShare").html("Send dette!");
                $('#sendShare').attr('href', 'https://www.facebook.com/dialog/send?'+app_id+display+redirect+'&link='+link);

            }
        }
        else {
            statusChanged("Error " + data);
        }
    });
}
var statusChanged = function(text) {
    $("#data").html($("#data").html() + "<br>" + text);
}
</script>
<a  id="new-friend" href="#" onclick="runAnalysis('Friend');"></a>
<a  id="new-event" href="#" onclick="runAnalysis('Event');"></a>
<br>
<a  id="start-test" href="#" onclick="runAnalysis('Start');$('#start-test').html('');">Start test</a>
<br>
<div id="data"></div>

<a id="sendShare" href=""></a>
<br>
<a id="postShare" href=""></a>
